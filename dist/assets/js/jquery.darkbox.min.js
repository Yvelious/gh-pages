!function(t){t.fn.darkbox=function(){function a(){clearInterval(k),l.css("background-position","24px 24px")}function o(){a(),h.animate({opacity:0},r,(function(){c.removeClass(e),l.stop(),b.unbind("error",d).attr("src","")}))}function i(a){27!==a.which&&32!==a.which||0===t("div.darkbox:hidden").length&&(a.preventDefault(),o())}function d(){a(),c.addClass("darkbox-error"),setTimeout(o,n)}t('<div class="darkbox"><div class="darkbox-shadow"></div><div class="darkbox-canvas"><img alt=""><div class="darkbox-button" title="Close"></div></div></div>').appendTo("body");var r=100,n=800,e="darkbox-on darkbox-done darkbox-loaded darkbox-error",s=/mac/i.test(navigator.platform)?"darkbox-button-left":"darkbox-button-right",c=t("div.darkbox"),h=c.children("div.darkbox-shadow"),l=c.children("div.darkbox-canvas"),b=l.children("img"),u=l.children("div.darkbox-button"),k=0,v=0;return h.css({opacity:0}).click(o),u.addClass(s).click(o),b.load((function(){a();var o=t(this),i=1,d=o.width(),r=o.height();i=c.width();var n=c.height();0===d&&0===r?setTimeout((function(){o.load()}),10):((d>i-50||r>n-50)&&(i=Math.min((i-50)/d,(n-50)/r),d=Math.round(d*i),r=Math.round(r*i)),c.addClass("darkbox-loaded"),l.animate({width:d,marginLeft:-d/2,height:r,marginTop:-r/2,opacity:1},400,(function(){c.addClass("darkbox-done")})))})),t(document).keypress(i).keydown(i),this.click((function(a){a.preventDefault(),a=t(this),c.addClass("darkbox-on"),l.css({width:"",marginLeft:"",height:"",marginTop:"",opacity:.5}),k=setInterval((function(){l.css("background-position","24px "+(24-56*v)+"px"),v=7<=v?0:v+1}),90),b.one("error",d).css({width:"",height:""}).attr("src",a.attr("href")).attr("alt",a.attr("title")),h.animate({opacity:.6},200)})),this}}(jQuery);